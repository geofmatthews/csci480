% latex foo.tex 
% dvips -Poutline -G0 foo.dvi -o 
% ps2pdf -dPDFSETTINGS#/prepress foo.ps
\documentclass[slidestop,xcolor=pst]{beamer}
\usepackage{etex}
\usepackage{fancyvrb}
\usepackage{hyperref}
%\usepackage{pstricks,pst-tree,pst-node,pst-plot,pst-3dplot}
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{arrows}

\newcommand{\mygraph}[2]{\includegraphics[width=#1\textwidth]{figures/#2}}
\newcommand{\mygraphc}[2]{\centerline{\includegraphics[width=#1\textwidth]{figures/#2}}}

\newcommand{\sect}[1]{
\section{#1}
\begin{frame}[fragile]\frametitle{#1}
}

\mode<presentation>
{
%  \usetheme{Madrid}
  % or ...

%  \setbeamercovered{transparent}
  % or whatever (possibly just delete it)
}

\usepackage[english]{babel}

\usepackage[latin1]{inputenc}

\title[Computer Graphics, CSCI 480, Ray Tracing IV]
{
Ray Tracing, Part IV
}

\subtitle{} % (optional)

\author[Geoffrey Matthews]
{Geoffrey Matthews}
% - Use the \inst{?} command only if the authors have different
%   affiliation.

\institute[WWU/CS]
{
  Department of Computer Science\\
  Western Washington University
}
% - Use the \inst command only if there are several affiliations.
% - Keep it simple, no one is interested in your street address.

\date{Fall 2015}

% If you have a file called "university-logo-filename.xxx", where xxx
% is a graphic format that can be processed by latex or pdflatex,
% resp., then you can add a logo as follows:

%\pgfdeclareimage[height=0.5cm]{university-logo}{WWULogoProColor}
%\logo{\pgfuseimage{university-logo}}

% If you wish to uncover everything in a step-wise fashion, uncomment
% the following command: 

%\beamerdefaultoverlayspecification{<+->}

\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\myref}[1]{\small\item\url{#1}}
\newcommand{\myreff}[1]{\scriptsize\item\url{#1}}

\begin{document}


\begin{frame}
  \titlepage
\end{frame}

\sect{Ellipsoids}
\begin{columns}
  \begin{column}{0.5\textwidth}
\mygraphc{0.6}{Ellipsoid_Quadric.png}
  \end{column}
  \begin{column}[b]{0.5\textwidth}
\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
  \end{column}
\end{columns}

\vfill

\bi
\item How can we intersect a ray with this surface?
\item How can we find the normal?
\item How can we rotate this shape?
\ei
\end{frame}


\sect{Intersect a ray with an ellipsoid}
Constraint on the surface:
\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
Points on the line generated by:
\[
p + tv = (p_0,p_1,p_2) + t(v_0,v_1,v_2)
\]
Plug one into the other to satisfy both:
\[
\frac{(p_0+tv_0)^2}{a^2} + \frac{(p_1+tv_1)^2}{b^2} + \frac{(p_2+tv_2)^2}{c^2} = 1
\]
Collect terms to get our quadratic to solve:
\[
\left(\frac{v_0^2}{a^2} + \frac{v_1^2}{b^2} +
\frac{v_2^2}{c^2}\right)t^2
+
\left(\frac{2p_0v_0}{a^2} + \frac{2p_1v_1}{b^2} +
\frac{2p_2v_2}{c^2}\right)t
+
\left(\frac{p_0^2}{a^2} + \frac{p_1^2}{b^2} +
\frac{p_2^2}{c^2}\right)
\]
\end{frame}

\sect{What about the normal for an ellipsoid?}
\mygraphc{0.7}{randomellipsoids02.png}
\end{frame}


\sect{Calculus to the rescue!}
\url{https://en.wikipedia.org/wiki/Gradient}
\end{frame}

\sect{Calculus to the rescue!}
\bi
\item
Ellipsoids satisfy the constraint:
\[
f(x,y,z) = \frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
\item
This means that the function $f$ is {\em constant} across the
surface.  If we take the {\em gradient} of $f$, it will be a vector pointing
in the direction of maximum change of $f$, which will be perpendicular
to the directions in which it is not changing at all.
\item
  The gradient is defined as
\[
\nabla f(x,y,z) = \left(
\frac{\partial f}{\partial x} +
\frac{\partial f}{\partial y} +
\frac{\partial f}{\partial z}
\right)
\]
\item
The partial derivative of a function, for example, $\frac{\partial
  f}{\partial x}$, is simply the derivative of $f$ treating everything
except $x$ as a constant.
\ei
\end{frame}

\sect{Normals for the ellipsoid}
\bi
\item For the ellipsoid, the function is
\[
f(x,y,z) = \frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
\item For this function, the gradient is easy to compute:
\[
\nabla f(x,y,z) = \frac{2x}{a^2} + \frac{2y}{b^2} + \frac{2z}{c^2}
\]
\item Since we want to normalize this anyway, we can drop the factor of 2.
\item
Note that this is in coordinates where the ellipsoid has not been
translated.  After we find our translated intersection point, we have
to translate it back by subtracting the ellipsoid's center before
calculating the normal.
\ei
\end{frame}

\sect{Other quadrics}
\bi
\item Using the tips above for the ellipsoid, you should be able to
  render any of the quadrics from this page:
  \url{https://en.wikipedia.org/wiki/Quadric}
  \ei
\end{frame}

\sect{What about rotating quadrics?}
\begin{tikzpicture}
%  \draw[help lines] (0,0) grid (10,2);
  \draw[thick] (8,0) -- (8,2) -- (10,2) -- (10,0) -- (8,0);
\draw[thick,gray,|->] (10.5,1) arc [radius=1.5, start angle=0, end angle=30];
  \draw[thick,*->] (0,1) -- (2,1);
\draw[thick,red] (7.8,1.8) -- (8.2,-0.2) -- (10.2,0.2) -- (9.8, 2.2) -- (7.8,1.8);
\end{tikzpicture}

\pause
\vfill
\hrulefill
\vfill

\begin{tikzpicture}
%\draw[help lines] (0,0) grid (10,4);
  \draw[thick] (8,0) -- (8,2) -- (10,2) -- (10,0) -- (8,0);
  \draw[thick,*->] (0,1) -- (2,1);
  \draw[thick,gray,|->] (-0.2,1) arc [radius=9.2, start angle=180, end angle=160];
  \draw[thick,red,*->] (0.5,4) -- (2.5,3.5);
\end{tikzpicture}

\end{frame}

\sect{How do we find the intersection point?}

\begin{tikzpicture}
%\draw[help lines] (0,0) grid (10,4);
  \draw[thick] (8,0) -- (8,2) -- (10,2) -- (10,0) -- (8,0);
  \draw[thick,*->] (0,1) -- (2,1);
  \draw[thick,gray,|->] (-0.2,1) arc [radius=9.2, start angle=180, end angle=160];
  \draw[thick,red,*->] (0.5,4) -- (2.5,3.5);
\end{tikzpicture}

\pause
\begin{itemize}
\item Translate the ray point (subtract the object center).
\item Rotate the ray point by the {\em inverse} rotation of the object.
\item Rotate the ray vector by the same rotation.
\item Find $t$, the distance along the ray to the intersection.
\item Use $t$ with the untransformed ray to find the point in world coordinates. 
\end{itemize}

\end{frame}

\sect{How do we find the normal?}

\begin{tikzpicture}
%\draw[help lines] (0,0) grid (10,4);
  \draw[thick] (8,0) -- (8,2) -- (10,2) -- (10,0) -- (8,0);
  \draw[thick,*->] (0,1) -- (2,1);
  \draw[thick,gray,|->] (-0.2,1) arc [radius=9.2, start angle=180, end angle=160];
  \draw[thick,red,*->] (0.5,4) -- (2.5,3.5);
\end{tikzpicture}

\pause
\begin{itemize}
\item Find the point on the {\em untransformed} object (use {\em transformed } ray).
\item Find the normal at that point using the gradient, as before.
\item Rotate this normal using the original rotation matrix.
\end{itemize}


\end{frame}

\end{document}

