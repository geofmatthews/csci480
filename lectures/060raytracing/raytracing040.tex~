% latex foo.tex 
% dvips -Poutline -G0 foo.dvi -o 
% ps2pdf -dPDFSETTINGS#/prepress foo.ps
\documentclass[slidestop,xcolor=pst]{beamer}
\usepackage{etex}
\usepackage{fancyvrb}
\usepackage{hyperref}
%\usepackage{pstricks,pst-tree,pst-node,pst-plot,pst-3dplot}
\usepackage{graphicx}

\newcommand{\mygraph}[2]{\includegraphics[width=#1\textwidth]{figures/#2}}
\newcommand{\mygraphc}[2]{\centerline{\includegraphics[width=#1\textwidth]{figures/#2}}}

\newcommand{\sect}[1]{
\section{#1}
\begin{frame}[fragile]\frametitle{#1}
}

\mode<presentation>
{
%  \usetheme{Madrid}
  % or ...

%  \setbeamercovered{transparent}
  % or whatever (possibly just delete it)
}

\usepackage[english]{babel}

\usepackage[latin1]{inputenc}

\title[Computer Graphics, CSCI 480, Ray Tracing III]
{
Ray Tracing, Part III
}

\subtitle{} % (optional)

\author[Geoffrey Matthews]
{Geoffrey Matthews}
% - Use the \inst{?} command only if the authors have different
%   affiliation.

\institute[WWU/CS]
{
  Department of Computer Science\\
  Western Washington University
}
% - Use the \inst command only if there are several affiliations.
% - Keep it simple, no one is interested in your street address.

\date{Fall 2015}

% If you have a file called "university-logo-filename.xxx", where xxx
% is a graphic format that can be processed by latex or pdflatex,
% resp., then you can add a logo as follows:

%\pgfdeclareimage[height=0.5cm]{university-logo}{WWULogoProColor}
%\logo{\pgfuseimage{university-logo}}

% If you wish to uncover everything in a step-wise fashion, uncomment
% the following command: 

%\beamerdefaultoverlayspecification{<+->}

\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\myref}[1]{\small\item\url{#1}}
\newcommand{\myreff}[1]{\scriptsize\item\url{#1}}

\begin{document}


\begin{frame}
  \titlepage
\end{frame}

\sect{Many things can be done with just spheres}
\mygraphc{.75}{ring00.png}
\end{frame}

\sect{Many things can be done with just spheres}
\mygraphc{.75}{ring01.png}
\end{frame}

\sect{Many things can be done with just spheres}
\mygraphc{.75}{ring02.png}
\end{frame}

\sect{Many things can be done with just spheres}
\mygraphc{.75}{ring03.png}
\end{frame}

\sect{Random spheres}
\mygraphc{.75}{randomspheres32.png}
\end{frame}

\sect{Fog: depth cueing with distance}
\mygraphc{.75}{randomspheresgreyfog.png}
\end{frame}

\sect{Colored Fog for Effects}
\mygraphc{.75}{randomspheresbluefog.png}
\end{frame}

\sect{George de La Tour, St. Joseph}
\mygraphc{.5}{La_Tour.jpg}
\end{frame}

\sect{Gerrit Van Honthorst, de Koppelaarster}
\mygraphc{}{gerrit_van_honthorst_-_de_koppelaarster.jpg}
\end{frame}

\sect{Rembrandt World}
\mygraphc{.75}{rembrandtworld.png}
\end{frame}
\sect{It would be nice to have some shapes other than spheres.}
\mygraphc{.75}{rembrandtworld.png}
\end{frame}


\sect{Ellipsoids}
\begin{columns}
  \begin{column}{0.5\textwidth}
\mygraphc{0.6}{Ellipsoid_Quadric.png}
  \end{column}
  \begin{column}[b]{0.5\textwidth}
\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
  \end{column}
\end{columns}

\vfill

\bi
\item How can we intersect a ray with this surface?
\item How can we find the normal?
\item How can we rotate this shape?
\ei
\end{frame}


\sect{Intersect a ray with an ellipsoid}
Constraint on the surface:
\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
Points on the line generated by:
\[
p + tv = (p_0,p_1,p_2) + t(v_0,v_1,v_2)
\]
Plug one into the other to satisfy both:
\[
\frac{(p_0+tv_0)^2}{a^2} + \frac{(p_1+tv_1)^2}{b^2} + \frac{(p_2+tv_2)^2}{c^2} = 1
\]
Collect terms to get our quadratic to solve:
\[
\left(\frac{v_0^2}{a^2} + \frac{v_1^2}{b^2} +
\frac{v_2^2}{c^2}\right)t^2
+
\left(\frac{2p_0v_0}{a^2} + \frac{2p_1v_1}{b^2} +
\frac{2p_2v_2}{c^2}\right)t
+
\left(\frac{p_0^2}{a^2} + \frac{p_1^2}{b^2} +
\frac{p_2^2}{c^2}\right)
\]
\end{frame}

\sect{What about the normal for an ellipsoid?}
\mygraphc{0.7}{randomellipsoids02.png}
\end{frame}


\sect{Calculus to the rescue!}
\url{https://en.wikipedia.org/wiki/Gradient}
\end{frame}

\sect{Calculus to the rescue!}
\bi
\item
Ellipsoids satisfy the constraint:
\[
f(x,y,z) = \frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
\item
This means that the function $f$ is {\em constant} across the
surface.  If we take the {\em gradient} of $f$, it will be a vector pointing
in the direction of maximum change of $f$, which will be perpendicular
to the directions in which it is not changing at all.
\item
  The gradient is defined as
\[
\nabla f(x,y,z) = \left(
\frac{\partial f}{\partial x} +
\frac{\partial f}{\partial y} +
\frac{\partial f}{\partial z}
\right)
\]
\item
The partial derivative of a function, for example, $\frac{\partial
  f}{\partial x}$, is simply the derivative of $f$ treating everything
except $x$ as a constant.
\ei
\end{frame}

\sect{Normals for the ellipsoid}
\bi
\item For the ellipsoid, the function is
\[
f(x,y,z) = \frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1
\]
\item For this function, the gradient is easy to compute:
\[
\nabla f(x,y,z) = \frac{2x}{a^2} + \frac{2y}{b^2} + \frac{2z}{c^2}
\]
\item Since we want to normalize this anyway, we can drop the factor of 2.
\item
Note that this is in coordinates where the ellipsoid has not been
translated.  After we find our translated intersection point, we have
to translate it back by subtracting the ellipsoid's center before
calculating the normal.
\ei
\end{frame}

\sect{Other quadrics}
\bi
\item Using the tips above for the ellipsoid, you should be able to
  render any of the quadrics from this page:
  \url{https://en.wikipedia.org/wiki/Quadric}
  \ei
\end{frame}

\sect{What about rotating quadrics?}
\end{frame}

\sect{Intersecting a ray and a plane}
\mygraphc{}{intersectingrayplane.png}
\begin{itemize}
\item Plane defined by point and normal.
\item Use same strategy as sphere?  What is the equation to solve? \pause
\item Solve for $t$: $n \cdot ((p+tv)-q) = 0$
\end{itemize}
\end{frame}

\sect{Intersecting a ray and a plane}
\begin{eqnarray*}
 n\cdot (p+tv - q) &=& 0\\
n\cdot p + t(n\cdot v) - n\cdot q &=& 0\\
t(n\cdot v) + n\cdot(p-q) &=& 0 \\
t &=& \frac{n\cdot (q-p)}{n\cdot v}
\end{eqnarray*}
\begin{itemize}
\item The intersection point is $p + tv$
\pause\item But there's other ways.
\end{itemize}

\end{frame}

\sect{Intersecting a ray and a plane}
\mygraph{}{intersectingrayplane.png}
\begin{itemize}
\item
$v\cdot n < 0$ tests for intersection (one-sided plane).
\item
Need to find the distance from $p$ to intersection point.
\item Can we find the sides of the triangle?  What is the height?
\end{itemize}
\end{frame}


\sect{Intersecting a ray and a plane}
\mygraph{}{intersectingrayplane02.png}
\begin{itemize}
\item $h = (p-q)\cdot n$ gives us the height $h$ of $p$ from the plane.
\end{itemize}
\end{frame}


\sect{Intersecting a ray and a plane}
\mygraphc{}{intersectingrayplane03.png}
\begin{itemize}
\item Any ideas?
\end{itemize}
\end{frame}


\sect{Intersecting a ray and a plane}
\mygraph{}{intersectingrayplane04.png}
\begin{itemize}
\item $v\cdot -n = \cos{\theta}$
\end{itemize}
\end{frame}


\sect{Intersecting a ray and a plane}
\mygraph{}{intersectingrayplane05.png}
\begin{itemize}
\item $v\cdot -n$ gives us: $\cos{\theta} = 1/\sec{\theta}$
\end{itemize}
\end{frame}



\sect{Intersecting a ray and a plane}
\mygraph{}{intersectingrayplane06.png}

\[ t = h\sec(\theta) = \frac{h}{\cos{\theta}} = \frac{(q-p)\cdot n}{v\cdot n}\]

\begin{itemize}
\item Desired point is $p+tv$
\item The same result as the other method.
\end{itemize}
\end{frame}

\sect{Plane delimited shapes}
\mygraphc{0.6}{planedelimited.png}
\end{frame}

\sect{Plane delimited shapes}
\mygraph{0.3}{planedelimited.png}
\begin{minipage}{3in}
  \bi
\item Plane normals all point outward.
\item Intersect the ray with all planes of the object.
\item Ray should hit every plane.  (And if not?).
  \item Ray hits object if it enters all entering planes before
    leaving first exit plane.
\item The hit point is the last plane entered.
\item If the last plane entered is nearer the eye than the first plane
  exited, the ray hits the object. 
\item Special case of {\em intersection}.  Think about intersecting
  all the other shapes we can raytrace.
 \ei
\end{minipage}
\end{frame}



\sect{Further Reading}
\begin{itemize}
\item
\url{https://www.siggraph.org/education/materials/HyperGraph/raytrace/rtinter0.htm}
\item \url{https://en.wikipedia.org/wiki/Quadric}
\item \url{http://marctenbosch.com/photon/mbosch_intersection.pdf}
\item\url{http://www.emeyex.com/site/projects/raytorus.pdf}
\item
\url{http://www.geisswerks.com/ryan/BLOBS/blobs.html}
\item 
 \url{http://www.cs.cornell.edu/courses/cs465/2003fa/homeworks/raytri.pdf}
\end{itemize}
\end{frame}

\end{document}

